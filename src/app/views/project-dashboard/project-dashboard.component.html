<main class="dashboard-main" (click)="closeImportMenu()">
<section class="dashboard-section">
  <!-- Import Menu Button - Fixed position -->
  <div class="import-menu-container">
    <button class="import-menu-button" (click)="toggleImportMenu($event)" title="Import project">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
      <span>Import</span>
    </button>
    @if (showImportMenu()) {
      <div class="import-dropdown" (click)="$event.stopPropagation()">
        <button class="import-option" (click)="importFromFolder()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
          </svg>
          <div class="import-option-text">
            <span class="import-option-title">Import from folder</span>
            <span class="import-option-desc">Each subfolder becomes a chapter, .txt files become documents</span>
          </div>
        </button>
        <button class="import-option" (click)="importFromExport()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
          <div class="import-option-text">
            <span class="import-option-title">Import from export</span>
            <span class="import-option-desc">Re-import a previously exported project with all metadata</span>
          </div>
        </button>
      </div>
    }
  </div>
  
  <!-- Loading state -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="animate-spin h-8 w-8 border-b-2 border-gray-900"></div>
  </div>
  } @else {
  <!-- Fixed 4x3 grid that fills the screen -->
  <div class="dashboard-grid">
    @for (cell of getGridCells(); track cell.index) {
      @if (cell.project) {
        <!-- Project Card -->
        <div class="card card-project"
             (click)="openProject(cell.project)"
             (contextmenu)="onProjectContextMenu(cell.project, $event)">
          <div class="card-title">
            <h3>{{ cell.project.name }}</h3>
          </div>
          <div class="card-pages">
            @if (getStats(cell.project.id).pageCount === 0) {
              <button class="delete-project-btn"
                      (click)="deleteProject(cell.project.id, $event)">
                Delete project
              </button>
            } @else {
              <span>{{ getStats(cell.project.id).pageCount + ' ' + (getStats(cell.project.id).pageCount === 1 ? 'page' : 'pages') }}</span>
            }
          </div>
        </div>
      } @else if (showCreate() && cell.index === editingCellIndex()) {
        <!-- New Project Card (inline edit) -->
        <div class="card card-project card-editing">
          <div class="card-title">
            <div class="inline-edit-wrapper">
              <input #newProjectInput
                     type="text"
                     [formControl]="nameControl"
                     class="inline-title-input"
                     placeholder="Title of the story"
                     (keydown.enter)="createQuick()"
                     (keydown.escape)="cancelEdit()"
                     (blur)="onInputBlur()" />
            </div>
          </div>
          <div class="card-pages">
            <span>No pages</span>
          </div>
        </div>
      } @else {
        <!-- Empty Card -->
        <div class="card card-empty"
             (click)="startCreateAt(cell.index)">
        </div>
      }
    }
  </div>
  }
</section>
</main>
