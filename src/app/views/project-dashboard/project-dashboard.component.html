<main class="dashboard-main">
<section class="dashboard-section">
  <!-- Loading state -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="animate-spin h-8 w-8 border-b-2 border-gray-900"></div>
  </div>
  } @else {
  <!-- Fixed 4x3 grid that fills the screen -->
  <div class="dashboard-grid">
    @for (cell of getGridCells(); track cell.index) {
      @if (cell.project) {
        <!-- Project Card -->
        <div class="card card-project"
             (click)="openProject(cell.project)"
             (contextmenu)="onProjectContextMenu(cell.project, $event)">
          <div class="card-title">
            <h3>{{ cell.project.name }}</h3>
          </div>
          <div class="card-pages">
            @if (getStats(cell.project.id).pageCount === 0) {
              <button class="delete-project-btn"
                      (click)="deleteProject(cell.project.id, $event)">
                Delete project
              </button>
            } @else {
              <span>{{ getStats(cell.project.id).pageCount + ' ' + (getStats(cell.project.id).pageCount === 1 ? 'page' : 'pages') }}</span>
            }
          </div>
        </div>
      } @else if (showCreate() && cell.index === editingCellIndex()) {
        <!-- New Project Card (inline edit) -->
        <div class="card card-project card-editing">
          <div class="card-title">
            <div class="inline-edit-wrapper">
              <input #newProjectInput
                     type="text"
                     [formControl]="nameControl"
                     class="inline-title-input"
                     placeholder="Title of the story"
                     (keydown.enter)="createQuick()"
                     (keydown.escape)="cancelEdit()"
                     (blur)="onInputBlur()" />
            </div>
          </div>
          <div class="card-pages">
            <span>No pages</span>
          </div>
        </div>
      } @else {
        <!-- Empty Card -->
        <div class="card card-empty"
             (click)="startCreateAt(cell.index)">
        </div>
      }
    }
  </div>
  }
</section>
</main>
