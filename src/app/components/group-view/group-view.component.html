@if (selectedGroup) {
<div class="editor-container">
  <!-- Toolbar with folder name and toggle buttons -->
  <div class="editor-toolbar">
    <div class="title-group">
      <input 
        #groupNameInput
        class="doc-title-input"
        [(ngModel)]="selectedGroup.name"
        (blur)="onNameChange(selectedGroup)"
        (keydown.enter)="onNameEnter($event)"
        [size]="getGroupTitleSize()"
        placeholder="Folder name" />
    </div>
    <div class="doc-tools">
      <!-- Storyline + Notes button group -->
      <div class="button-group">
        <!-- Storyline toggle -->
        <button 
          class="toolbar-button toggle-labeled" 
          (click)="toggleDocCards()" 
          [class.active]="activeTab === 'docs'"
          aria-label="Storyline" 
          title="Document Cards">
          <svg class="icon-cards" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 4h4v4H4V4zm6 0h4v4h-4V4zm6 0h4v4h-4V4zM4 10h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4zM4 16h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4z"/>
          </svg>
          <span class="tool-label">Storyline</span>
        </button>

        <!-- Notes toggle -->
        <button 
          class="toolbar-button toggle-labeled" 
          (click)="toggleNotes()" 
          [class.active]="activeTab === 'notes'"
          aria-label="Notes" 
          title="Folder Notes">
          <svg class="icon-notes" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
          </svg>
          <span class="tool-label">Notes</span>
        </button>
      </div>
    </div>
  </div>
  
  <div class="group-content">
    @if (activeTab === 'docs') {
      <div class="doc-cards-container">
        @for (doc of selectedGroup.docs; track doc.id; let j = $index) {
          <div class="doc-card" (click)="onDocCardClick(doc)">
            <div class="doc-card-header">
              <span class="doc-card-index">{{ j + 1 }}.</span>
              <span class="doc-card-name">{{ doc.name || 'Untitled' }}</span>
            </div>
            <div class="doc-card-metadata">
              <!-- Characters row -->
              <app-metadata-chips
                [items]="getDocCharacters(doc.id)"
                [availableItems]="getAvailableCharactersForDoc(doc.id)"
                [allItems]="characters"
                type="character"
                placeholder="New character..."
                (remove)="onCharacterRemove(doc.id, $event)"
                (add)="onCharacterAdd(doc.id, $event)"
                (create)="onCharacterCreate(doc.id, $event)"
                (deleteItem)="characterDelete.emit($event)"
                (editItem)="characterEdit.emit($event)"
                (reorder)="onCharacterReorder(doc.id, $event)">
              </app-metadata-chips>

              <!-- Events row -->
              <app-metadata-chips
                [items]="getDocEvents(doc.id)"
                [availableItems]="getAvailableEventsForDoc(doc.id)"
                [allItems]="events"
                type="event"
                placeholder="New event..."
                (remove)="onEventRemove(doc.id, $event)"
                (add)="onEventAdd(doc.id, $event)"
                (create)="onEventCreate(doc.id, $event)"
                (deleteItem)="eventDelete.emit($event)"
                (editItem)="eventEdit.emit($event)"
                (reorder)="onEventReorder(doc.id, $event)">
              </app-metadata-chips>

              <!-- Places row -->
              <app-metadata-chips
                [items]="getDocPlaces(doc.id)"
                [availableItems]="getAvailablePlacesForDoc(doc.id)"
                [allItems]="places"
                type="place"
                placeholder="New place..."
                (remove)="onPlaceRemove(doc.id, $event)"
                (add)="onPlaceAdd(doc.id, $event)"
                (create)="onPlaceCreate(doc.id, $event)"
                (deleteItem)="placeDelete.emit($event)"
                (editItem)="placeEdit.emit($event)"
                (reorder)="onPlaceReorder(doc.id, $event)">
              </app-metadata-chips>
            </div>
          </div>
        }
        @empty {
          <div class="empty-state">No documents in this folder</div>
        }
      </div>
    }
    @if (activeTab === 'notes') {
      <app-folder-drafts
        [drafts]="folderDrafts"
        [selectedDraftId]="selectedFolderDraftId"
        [layout]="'grid'"
        (draftCreate)="createFolderDraft()"
        (draftChange)="onFolderDraftChange($event.draftId, $event.content, $event.cursorPosition)"
        (draftNameChange)="onFolderDraftNameChange($event.draftId, $event.name)"
        (draftDelete)="deleteFolderDraft($event)"
        (draftMove)="onDraftMove($event)"
        (draftSelect)="onDraftSelect($event)">
      </app-folder-drafts>
    }
  </div>
</div>
}
