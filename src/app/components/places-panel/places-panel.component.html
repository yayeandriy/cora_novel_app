<div class="sidebar-section">
  <div class="section-header">
    <div class="section-title">
      <span>Places</span>
    </div>
    <div class="header-actions">
    <button 
      class="add-button" 
      [class.active]="isSelectMode"
      (click)="onAddClick($event)"
      [title]="isSelectMode ? 'Done selecting' : 'Select places'">
      @if (!isSelectMode) {
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <!-- Pencil icon -->
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 3.487a2.25 2.25 0 013.182 3.182L8.207 18.506a4.5 4.5 0 01-1.691 1.066L3 21l1.428-3.516a4.5 4.5 0 011.066-1.691L16.862 3.487z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 5l4 4" />
        </svg>
      } @else {
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <!-- Cross icon -->
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 6l12 12M18 6l-12 12" />
        </svg>
      }
    </button>
    </div>
  </div>
  <div class="section-content">
      @if (isSelectMode && !newPlace) {
        <button class="list-add-button" (click)="onAddPlaceClick($event)">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="icon">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
          </svg>
          <span>Add place</span>
        </button>
      }

      @if (newPlace) {
        <app-place-card
          [place]="newPlace"
          [checked]="false"
          [canToggle]="false"
          [editing]="true"
          [mode]="'view'"
          (update)="onNewPlaceSave($event)"
          (remove)="onNewPlaceCancel()">
        </app-place-card>
      }
      
      <div class="cards-list" cdkDropList [cdkDropListData]="visiblePlaces" (cdkDropListDropped)="onDropCdk($event)">
        @for (place of visiblePlaces; track place.id; let i = $index) {
          <div class="drag-item" cdkDrag>
            <button class="drag-handle" cdkDragHandle title="Drag to reorder" (click)="$event.stopPropagation()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 4h6M9 8h6M9 12h6M9 16h6M9 20h6"/>
              </svg>
            </button>
            <app-place-card
              [place]="place"
              [checked]="docPlaceIds?.has(place.id) || false"
              [canToggle]="!!selectedDoc"
              [editing]="editingPlaceId === place.id"
              [mode]="isSelectMode ? 'selectable' : 'view'"
              (toggle)="toggle.emit({ placeId: $event.id, checked: $event.checked })"
              (update)="update.emit($event)"
              (remove)="remove.emit($event)">
            </app-place-card>
          </div>
        }
      </div>
      
      @if (!isSelectMode && visiblePlaces.length === 0 && places.length > 0) {
        <div class="empty-state">
          <p>No places attached</p>
          <p class="hint">Click + to select places</p>
        </div>
      }
  </div>
</div>
