<div class="project-timeline">
  <div class="project-title-section">
    <div class="project-name">{{ projectName || 'Untitled Project' }}</div>
    @if (projectDesc) {
      <div class="project-desc">{{ projectDesc }}</div>
    }
  </div>

  <div class="timeline-bar">
    <button class="timeline-button start-button" (click)="openStartDatePicker()" [disabled]="!editable">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <span>
        @if (formattedStartDate) {
          {{ formattedStartDate }}
        } @else {
          Set Start
        }
      </span>
    </button>

  <!-- Inline fallback input used when programmatic opening is blocked -->
  @if (showStartInline) {
    <input #inlineStartInput type="date" class="inline-date-input" [value]="formattedStartDate" (change)="onStartDateChange($any($event.target).value)" />
  }

    <div class="timeline-track" (click)="onTimelineClick($event)">
      <div class="ticks">
        @for (tick of getTicks().slice(1); track tick.position + tick.label) {
          <div class="tick" [style.left.%]="tick.position" [class.major]="tick.type === 'year' || tick.type === 'month'" [class.year]="tick.type === 'year'"
          style="margin-top: 20px;"
          >
            <div class="tick-line"></div>
            <div class="tick-label">{{ tick.label }}</div>
          </div>
        }
      </div>
      
      <!-- Doc timeline intervals -->
      <div class="doc-timelines">
        @for (docTimeline of getDocTimelineIntervals(); track docTimeline.docId) {
          <div class="doc-timeline-interval" 
               [style.left.%]="docTimeline.startPosition" 
               [style.width.%]="docTimeline.width"
               [class.selected]="docTimeline.docId === selectedDocId"
               [title]="docTimeline.docName"
               (click)="onDocIntervalClick($event, docTimeline.docId)">
            <!-- Draggable handles on edges - only for selected doc -->
            @if (docTimeline.docId === selectedDocId) {
              <div class="interval-handle interval-handle-start" 
                   (mousedown)="onHandleDragStart($event, docTimeline.docId, 'start')"
                   title="Drag to adjust start date"></div>
              <div class="interval-handle interval-handle-end" 
                   (mousedown)="onHandleDragStart($event, docTimeline.docId, 'end')"
                   title="Drag to adjust end date"></div>
            }
          </div>
        }
      </div>
    </div>

    <button class="timeline-button end-button" (click)="openEndDatePicker()" [disabled]="!editable">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <span>
        @if (formattedEndDate) {
          {{ formattedEndDate }}
        } @else {
          Set End
        }
      </span>
    </button>

  <!-- Inline fallback input used when programmatic opening is blocked -->
  @if (showEndInline) {
    <input #inlineEndInput type="date" class="inline-date-input" [value]="formattedEndDate" (change)="onEndDateChange($any($event.target).value)" />
  }
  </div>
</div>
