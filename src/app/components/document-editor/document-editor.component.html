@if (selectedDoc) {
<div class="editor-container">
  <div class="editor-toolbar">
    <div class="title-group">
      <input 
        #docTitleInput
        type="text" 
        class="doc-title-input" 
        [(ngModel)]="selectedDoc.name"
        [attr.size]="getDocTitleSize()"
        (blur)="onTitleChange(selectedDoc!)"
        (keydown.enter)="focusEditor()"
        placeholder="Untitled">
      @if (showSaveStatus) { <span class="tab-dot" title="Saved">âœ“</span> }
    </div>
    <div class="toolbar-actions">
      <div class="draft-controls">
        <div class="draft-tabs">
          @for (d of drafts; track d.id) {
            <div class="draft-tab-wrapper">
              @if (editingDraftId === d.id) {
                <div class="draft-edit-row">
                  <input
                    #draftNameInput
                    class="draft-name-input"
                    [(ngModel)]="draftNameEdit"
                    (blur)="saveDraftName()"
                    (keydown.enter)="saveDraftName()"
                    (keydown.escape)="cancelDraftNameEdit()"
                    placeholder="Draft name" />
                  <button
                    class="draft-delete-btn"
                    (mousedown)="$event.preventDefault()"
                    (click)="onClickDeleteDraft(d.id)"
                    title="Delete draft">
                    ðŸ—‘
                  </button>
                </div>
              } @else {
                <button 
                  class="draft-tab" 
                  [class.active]="d.id === selectedDraftId"
                  (click)="selectOrToggle(d.id, $event)"
                  (dblclick)="startEditDraftName(d.id, d.name)"
                  title="Open draft (double-click to rename)">
                  {{ d.name }}
                  @if (draftSyncStatus[d.id] === 'syncing') { <span class="tab-dot">âŸ³</span> }
                  @if (draftSyncStatus[d.id] === 'synced') { <span class="tab-dot">âœ“</span> }
                </button>
              }
            </div>
          }
        </div>
        <button class="toolbar-button" (click)="addDraft()" title="Add draft">+ Draft</button>
      </div>
    </div>
  </div>
  
  @if (!selectedDraft) {
    <textarea 
      #editorTextarea
      [(ngModel)]="selectedDoc.text"
      (input)="onTextChange()"
      class="editor-textarea"
      (blur)="onBlur()"
      placeholder="Start writing...">
    </textarea>
  } @else {
    <div class="editor-split" #splitContainer>
      <div class="pane">
        <textarea 
          #editorTextarea
          [(ngModel)]="selectedDoc.text"
          (input)="onTextChange()"
          class="editor-textarea"
          (blur)="onBlur()"
          placeholder="Start writing...">
        </textarea>
      </div>
      <div class="split-divider" 
           [class.collapsed]="isSplitCollapsed"
           title="Drag to resize. Double-click to {{ isSplitCollapsed ? 'expand' : 'collapse' }}"
           (mousedown)="startResize($event)"
           (dblclick)="toggleCollapse()">
        <span class="divider-grip"></span>
      </div>
      @if (!isSplitCollapsed) {
        <div class="pane pane-right " [style.flex]="'0 0 ' + draftPaneWidth + 'px'" [style.width.px]="draftPaneWidth">
          <textarea 
            #draftTextarea
            [(ngModel)]="selectedDraft!.content"
            (input)="onDraftInput($event, selectedDraft!.id)"
            (blur)="onDraftBlur(selectedDraft!.id)"
            class="editor-textarea"
            placeholder="Draft content...">
          </textarea>
        </div>
      }
    </div>
  }
  
  <div class="editor-footer">
    <div class="stats-container">
      <span class="stat-item">
        <span class="stat-label">A:</span>
        <span class="stat-value">{{ getDocCharCount() }}</span>
        <span class="stat-project">({{ formatNumber(getProjectCharCount()) }})</span>
      </span>
      <span class="stat-item">
        <span class="stat-label">W:</span>
        <span class="stat-value">{{ getDocWordCount() }}</span>
        <span class="stat-project">({{ formatNumber(getProjectWordCount()) }})</span>
      </span>
      <span class="stat-item">
        <svg class="page-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <span class="stat-value">{{ getDocPageCount() }}</span>
        <span class="stat-project">({{ getProjectPageCount() }})</span>
      </span>
    </div>
  </div>
</div>
}
