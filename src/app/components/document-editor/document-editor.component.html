@if (selectedDoc) {
<div class="editor-container">
  <div class="editor-toolbar" (click)="onToolbarClick($event)">
    <div class="title-group">
      @if (docIndexLabel) { <span class="header-index clickable" (click)="onHeaderIndexClick($event)" title="Click to show project/folder headers">{{ docIndexLabel }}.</span> }
      <input 
        #docTitleInput
        type="text" 
        class="doc-title-input" 
        [(ngModel)]="selectedDoc.name"
        [attr.size]="getDocTitleSize()"
        (blur)="onTitleChange(selectedDoc!)"
        (keydown.enter)="focusEditor()"
        placeholder="Untitled">
      @if (showSaveStatus) { <span class="tab-dot" title="Saved">âœ“</span> }
    </div>
    <div class="toolbar-actions">
      <div class="draft-controls">
        @if (!isSplitCollapsed) {
          <div class="draft-tabs">
            @for (d of drafts; track d.id) {
              <div class="draft-tab-wrapper">
                @if (editingDraftId === d.id) {
                  <div class="draft-edit-row">
                    <input
                      #draftNameInput
                      class="draft-name-input"
                      [(ngModel)]="draftNameEdit"
                      (blur)="saveDraftName()"
                      (keydown.enter)="saveDraftName()"
                      (keydown.escape)="cancelDraftNameEdit()"
                      placeholder="Draft name" />
                    <button
                      class="draft-delete-btn"
                      (mousedown)="$event.preventDefault()"
                      (click)="onClickDeleteDraft(d.id)"
                      title="Delete draft">
                      ðŸ—‘
                    </button>
                  </div>
                } @else {
                  <button 
                    class="draft-tab" 
                    [class.active]="d.id === selectedDraftId"
                    (click)="selectOrToggle(d.id, $event)"
                    (dblclick)="startEditDraftName(d.id, d.name)"
                    title="Open draft (double-click to rename)">
                    {{ d.name }}
                    @if (draftSyncStatus[d.id] === 'syncing') { <span class="tab-dot">âŸ³</span> }
                    @if (draftSyncStatus[d.id] === 'synced') { <span class="tab-dot">âœ“</span> }
                  </button>
                }
              </div>
            }
          </div>
          <button class="toolbar-button" (click)="addDraft()" aria-label="Add draft" title="Add draft">
            <svg class="icon-plus" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11 5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6V5z"/>
            </svg>
          </button>
        }
        <button class="toolbar-button toggle-uniform" (click)="toggleDraftControls()" [class.active]="!isSplitCollapsed" aria-label="Document drafts" title="Document drafts">
          @if (drafts.length > 0) {
            <span class="drafts-count">{{ drafts.length }}</span>
          } @else {
            <svg class="icon-drafts" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 7h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2zm0-2a2 2 0 0 0-2 2v1h12a2 2 0 0 1 2 2V7a2 2 0 0 0-2-2H7z"/>
            </svg>
          }
        </button>
      </div>
    </div>
  </div>
  
  @if (!selectedDraft) {
    <div class="resizable-editor-container" [style.width.px]="editorWidthPx">
      <div class="resize-handle left" (mousedown)="initResize($event, 'left')"></div>
      <textarea 
        #editorTextarea
        [(ngModel)]="selectedDoc.text"
        (input)="onTextChange()"
        class="editor-textarea"
        (blur)="onBlur()"
        placeholder="Start writing...">
      </textarea>
      <div class="resize-handle right" (mousedown)="initResize($event, 'right')"></div>
    </div>
  } @else {
    <div class="editor-split" #splitContainer>
      <div class="pane">
        <div class="resizable-editor-container" [style.width.px]="editorWidthPx">
          <div class="resize-handle left" (mousedown)="initResize($event, 'left')"></div>
          <textarea 
            #editorTextarea
            [(ngModel)]="selectedDoc.text"
            (input)="onTextChange()"
            class="editor-textarea"
            (blur)="onBlur()"
            placeholder="Start writing...">
          </textarea>
          <div class="resize-handle right" (mousedown)="initResize($event, 'right')"></div>
        </div>
      </div>
      <div class="split-divider" 
           [class.collapsed]="isSplitCollapsed"
           title="Drag to resize. Double-click to {{ isSplitCollapsed ? 'expand' : 'collapse' }}"
           (mousedown)="startResize($event)"
           (dblclick)="toggleCollapse()">
        <span class="divider-grip"></span>
      </div>
      @if (!isSplitCollapsed) {
        <div class="pane pane-right " [style.flex]="'0 0 ' + draftPaneWidth + 'px'" [style.width.px]="draftPaneWidth">
          <textarea 
            #draftTextarea
            [(ngModel)]="selectedDraft!.content"
            (input)="onDraftInput($event, selectedDraft!.id)"
            (blur)="onDraftBlur(selectedDraft!.id)"
            class="editor-textarea"
            placeholder="Draft content...">
          </textarea>
        </div>
      }
    </div>
  }
  
  <!-- Footer removed: stats & width control migrated to global app footer -->
</div>
}
