@if (selectedDoc) {
<div class="editor-container" [style.--editor-width-percent.%]="editorWidthPercent">
  <div class="editor-toolbar" (click)="onToolbarClick($event)">
    <div class="title-group">
      @if (docIndexLabel) { <span class="header-index clickable" (click)="onHeaderIndexClick($event)" title="Click to show project/folder headers">{{ docIndexLabel }}.</span> }
      <input 
        #docTitleInput
        type="text" 
        class="doc-title-input" 
        [(ngModel)]="selectedDoc.name"
        [attr.size]="getDocTitleSize()"
        (blur)="onTitleChange(selectedDoc!)"
        (keydown.enter)="focusEditor()"
        placeholder="Untitled">
      @if (showSaveStatus) { <span class="tab-dot" title="Saved">âœ“</span> }
    </div>
    <div class="toolbar-actions">
      <div class="doc-tools">
        <!-- Storyline button -->
        <button class="toolbar-button toggle-labeled" (click)="docCardsToggle.emit()" [class.active]="docCardsExpanded" aria-label="Storyline" title="Storyline - Project overview">
          <svg class="icon-cards" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 4h4v4H4V4zm6 0h4v4h-4V4zm6 0h4v4h-4V4zM4 10h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4zM4 16h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4z"/>
          </svg>
          <span class="tool-label">Storyline</span>
        </button>
        
        <!-- Notes button -->
        <button class="toolbar-button toggle-labeled" (click)="folderNotesToggle.emit()" [class.active]="folderNotesExpanded" aria-label="Notes" title="Notes - Folder notes">
          @if (folderDraftsCount > 0) {
            <span class="count-circle">{{ folderDraftsCount }}</span>
          } @else {
            <svg class="icon-folder" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 6a2 2 0 0 1 2-2h5l2 2h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6z"/>
            </svg>
          }
          <span class="tool-label">Notes</span>
        </button>
        
        <!-- Drafts button -->
        <button class="toolbar-button toggle-labeled" (click)="toggleDraftControls()" [class.active]="!isSplitCollapsed" aria-label="Drafts" title="Drafts - Document drafts">
          @if (drafts.length > 0) {
            <span class="count-circle">{{ drafts.length }}</span>
          } @else {
            <svg class="icon-drafts" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 7h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2zm0-2a2 2 0 0 0-2 2v1h12a2 2 0 0 1 2 2V7a2 2 0 0 0-2-2H7z"/>
            </svg>
          }
          <span class="tool-label">Drafts</span>
        </button>
      </div>
    </div>
  </div>
  
  @if (!selectedDraft) {
    <div class="resizable-editor-container" [style.width.px]="editorWidthPx">
      <div class="resize-handle left" (mousedown)="initResize($event, 'left')"></div>
      <textarea 
        #editorTextarea
        [(ngModel)]="selectedDoc.text"
        (input)="onTextChange()"
        (scroll)="editorScroll.emit($any($event.target).scrollTop)"
        class="editor-textarea"
        (blur)="onBlur()"
        [placeholder]="editorPlaceholder">
      </textarea>
      <div class="resize-handle right" (mousedown)="initResize($event, 'right')"></div>
    </div>
  } @else {
    <div class="editor-split" #splitContainer>
      <div class="pane">
        <div class="resizable-editor-container" [style.width.px]="editorWidthPx">
          <div class="resize-handle left" (mousedown)="initResize($event, 'left')"></div>
          <textarea 
            #editorTextarea
            [(ngModel)]="selectedDoc.text"
            (input)="onTextChange()"
            (scroll)="editorScroll.emit($any($event.target).scrollTop)"
            class="editor-textarea"
            (blur)="onBlur()"
            [placeholder]="editorPlaceholder">
          </textarea>
          <div class="resize-handle right" (mousedown)="initResize($event, 'right')"></div>
        </div>
      </div>
      <div class="split-divider" 
           [class.collapsed]="isSplitCollapsed"
           title="Drag to resize. Double-click to {{ isSplitCollapsed ? 'expand' : 'collapse' }}"
           (mousedown)="startResize($event)"
           (dblclick)="toggleCollapse()">
        <span class="divider-grip"></span>
      </div>
      @if (!isSplitCollapsed) {
        <div class="pane pane-right" [style.flex]="'0 0 ' + draftPaneWidth + 'px'" [style.width.px]="draftPaneWidth">
          <!-- Drafts header row -->
          <div class="drafts-header-row">
            <div class="draft-tabs" (wheel)="onDraftTabsWheel($event)">
              @for (d of drafts; track d.id) {
                <div class="draft-tab-wrapper">
                  @if (editingDraftId === d.id) {
                    <div class="draft-edit-row">
                      <input
                        #draftNameInput
                        class="draft-name-input"
                        [(ngModel)]="draftNameEdit"
                        (blur)="saveDraftName()"
                        (keydown.enter)="saveDraftName()"
                        (keydown.escape)="cancelDraftNameEdit()"
                        placeholder="Draft name" />
                      <button
                        class="draft-delete-btn"
                        (mousedown)="$event.preventDefault()"
                        (click)="onClickDeleteDraft(d.id)"
                        title="Delete draft">
                        ðŸ—‘
                      </button>
                    </div>
                  } @else {
                    <button 
                      class="draft-tab" 
                      [class.active]="d.id === selectedDraftId"
                      (click)="selectOrToggle(d.id, $event)"
                      (dblclick)="startEditDraftName(d.id, d.name)"
                      title="Open draft (double-click to rename)">
                      {{ d.name }}
                      @if (draftSyncStatus[d.id] === 'syncing') { <span class="tab-dot">âŸ³</span> }
                      @if (draftSyncStatus[d.id] === 'synced') { <span class="tab-dot">âœ“</span> }
                    </button>
                  }
                </div>
              }
            </div>
            <button class="toolbar-button" (click)="addDraft()" aria-label="Add draft" title="Add draft">
              <svg class="icon-plus" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11 5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6V5z"/>
              </svg>
            </button>
          </div>
          <textarea 
            #draftTextarea
            [(ngModel)]="selectedDraft!.content"
            (input)="onDraftInput($event, selectedDraft!.id)"
            (blur)="onDraftBlur(selectedDraft!.id)"
            class="editor-textarea"
            placeholder="Draft content...">
          </textarea>
        </div>
      }
    </div>
  }
  
  <!-- Docker removed: stats & width control migrated to global app docker -->
</div>
}
