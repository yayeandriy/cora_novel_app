<aside class="right-sidebar">
  <div class="resize-handle right" (mousedown)="startResize($event)" (dblclick)="onToggleCollapse()">
    <span class="divider-grip"></span>
  </div>
  
  <!-- Tabs Navigation -->
  <div class="tabs-nav">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'doc'"
      (click)="switchTab('doc')">
      Doc
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'folder'"
      (click)="switchTab('folder')">
      Folder
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'project'"
      (click)="switchTab('project')">
      Project
    </button>
  </div>

  <div class="sidebar-content">
    <!-- DOC TAB CONTENT -->
    @if (activeTab === 'doc') {
      <!-- Characters Section (separate component) -->
      <app-characters-panel
      [characters]="characters"
      [docCharacterIds]="docCharacterIds"
      [selectedDoc]="selectedDoc"
      [expanded]="charactersExpanded"
      [editingCharacterId]="editingCharacterId"
      (expandedChange)="onCharactersToggle()"
      (add)="onCharacterAdd()"
      (createCharacter)="onCharacterCreate($event)"
      (update)="onCharacterUpdate($event)"
      (remove)="onCharacterDelete($event)"
      (toggle)="characterToggle.emit($event)"
      (reorder)="charactersReorder.emit($event)">
    </app-characters-panel>

    <!-- Events Section (separate component) -->
    <app-events-panel
      [events]="events"
      [docEventIds]="docEventIds"
      [selectedDoc]="selectedDoc"
      [expanded]="eventsExpanded"
      [editingEventId]="editingEventId"
      [timelineHeaderVisible]="timelineHeaderVisible"
      (expandedChange)="onEventsToggle()"
      (add)="eventAdd.emit()"
      (createEvent)="onEventCreate($event)"
      (update)="eventUpdate.emit($event)"
      (remove)="eventDelete.emit($event)"
      (toggle)="eventToggle.emit($event)"
      (reorder)="eventsReorder.emit($event)"
      (timelineHeaderToggle)="onTimelineHeaderToggle()">
    </app-events-panel>

    <!-- Places Section (separate component) -->
    <app-places-panel
      [places]="places"
      [docPlaceIds]="docPlaceIds"
      [selectedDoc]="selectedDoc"
      [expanded]="placesExpanded"
      [editingPlaceId]="editingPlaceId"
      (expandedChange)="onPlacesToggle()"
      (add)="onPlaceAdd()"
      (createPlace)="onPlaceCreate($event)"
      (update)="onPlaceUpdate($event)"
      (remove)="onPlaceDelete($event)"
      (toggle)="placeToggle.emit($event)"
      (reorder)="placesReorder.emit($event)">
    </app-places-panel>
    }

    <!-- FOLDER TAB CONTENT -->
    @if (activeTab === 'folder') {
      <!-- Notes Section for Folder (first) -->
      <div class="sidebar-section">
        <div class="section-header" (click)="onNotesToggle()">
          <div class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="toggle-icon" [class.expanded]="notesExpanded" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
            <span>Folder Notes</span>
          </div>
        </div>
        
        @if (notesExpanded && selectedDocGroup) {
          <div class="section-content">
            <textarea 
              class="notes-textarea"
              [persistTextareaHeight]="'rs:notes:folder:' + selectedDocGroup.project_id"
              [(ngModel)]="selectedDocGroup.notes"
              (input)="onDocGroupNotesChange()"
              placeholder="Add folder notes..."></textarea>
          </div>
        }
        @if (notesExpanded && !selectedDocGroup) {
          <div class="section-content">
            <p style="font-size: 0.875rem; color: #9ca3af; padding: 0.5rem;">Select a folder to add notes</p>
          </div>
        }
      </div>

      <!-- Characters Section for Folder -->
      <app-characters-panel
        [characters]="characters"
        [docCharacterIds]="docGroupCharacterIds"
        [selectedDoc]="selectedDocGroup"
        [expanded]="charactersExpanded"
        [editingCharacterId]="editingCharacterId"
        (expandedChange)="onCharactersToggle()"
        (add)="onCharacterAdd()"
        (createCharacter)="onCharacterCreate($event)"
        (update)="onCharacterUpdate($event)"
        (remove)="onCharacterDelete($event)"
        (toggle)="onDocGroupCharacterToggle($event.characterId, $event)"
        (reorder)="charactersReorder.emit($event)">
      </app-characters-panel>

      <!-- Events Section for Folder -->
      <app-events-panel
        [events]="events"
        [docEventIds]="docGroupEventIds"
        [selectedDoc]="null"
        [expanded]="eventsExpanded"
        [editingEventId]="editingEventId"
        [timelineHeaderVisible]="timelineHeaderVisible"
        (expandedChange)="onEventsToggle()"
        (add)="eventAdd.emit()"
        (createEvent)="onEventCreate($event)"
        (update)="eventUpdate.emit($event)"
        (remove)="eventDelete.emit($event)"
        (toggle)="onDocGroupEventToggle($event.eventId, $event)"
        (reorder)="eventsReorder.emit($event)"
        (timelineHeaderToggle)="onTimelineHeaderToggle()">
      </app-events-panel>

      <!-- Places Section for Folder -->
      <app-places-panel
        [places]="places"
        [docPlaceIds]="docGroupPlaceIds"
        [selectedDoc]="null"
        [expanded]="placesExpanded"
        [editingPlaceId]="editingPlaceId"
        (expandedChange)="onPlacesToggle()"
        (add)="onPlaceAdd()"
        (createPlace)="onPlaceCreate($event)"
        (update)="onPlaceUpdate($event)"
        (remove)="onPlaceDelete($event)"
        (toggle)="onDocGroupPlaceToggle($event.placeId, $event)"
        (reorder)="placesReorder.emit($event)">
      </app-places-panel>
    }

    <!-- PROJECT TAB CONTENT -->
    @if (activeTab === 'project') {
      <!-- Notes Section for Project (first) -->
      <div class="sidebar-section">
        <div class="section-header" (click)="onNotesToggle()">
          <div class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" class="toggle-icon" [class.expanded]="notesExpanded" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
            <span>Project Notes</span>
          </div>
        </div>
        
        @if (notesExpanded) {
          <div class="section-content">
            @if (project) {
              <textarea 
                class="notes-textarea"
                [persistTextareaHeight]="'rs:notes:project:' + project.id"
                [(ngModel)]="project.notes"
                (input)="onProjectNotesChange()"
                placeholder="Add project notes..."></textarea>
            }
          </div>
        }
      </div>

      <!-- Characters Section for Project -->
      <app-characters-panel
        [characters]="characters"
        [docCharacterIds]="null"
        [selectedDoc]="null"
        [expanded]="charactersExpanded"
        [editingCharacterId]="editingCharacterId"
        (expandedChange)="onCharactersToggle()"
        (add)="onCharacterAdd()"
        (update)="onCharacterUpdate($event)"
        (remove)="onCharacterDelete($event)"
        (reorder)="charactersReorder.emit($event)">
      </app-characters-panel>

      <!-- Events Section for Project -->
      <app-events-panel
        [events]="events"
        [docEventIds]="null"
        [selectedDoc]="null"
        [expanded]="eventsExpanded"
        [editingEventId]="editingEventId"
        [timelineHeaderVisible]="timelineHeaderVisible"
        (expandedChange)="onEventsToggle()"
        (add)="eventAdd.emit()"
        (createEvent)="onEventCreate($event)"
        (update)="eventUpdate.emit($event)"
        (remove)="eventDelete.emit($event)"
        (reorder)="eventsReorder.emit($event)"
        (timelineHeaderToggle)="onTimelineHeaderToggle()">
      </app-events-panel>

      <!-- Places Section for Project -->
      <app-places-panel
        [places]="places"
        [docPlaceIds]="null"
        [selectedDoc]="null"
        [expanded]="placesExpanded"
        [editingPlaceId]="editingPlaceId"
        (expandedChange)="onPlacesToggle()"
        (add)="onPlaceAdd()"
        (createPlace)="onPlaceCreate($event)"
        (update)="onPlaceUpdate($event)"
        (remove)="onPlaceDelete($event)"
        (reorder)="placesReorder.emit($event)">
      </app-places-panel>
    }
  </div>
</aside>
