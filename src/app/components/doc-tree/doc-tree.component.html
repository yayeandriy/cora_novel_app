<aside class="left-sidebar">
  <div class="sidebar-header">
  </div>

  <div class="sidebar-content">
    <div class="doc-tree" #docTree tabindex="0" (keydown)="handleTreeKeyDown($event)">
      <!-- Empty state -->
      @if (docGroups.length === 0) {
        <div class="empty-state">
          <p class="empty-message">No parts yet</p>
          <p class="empty-hint">Create your first part</p>
        </div>
      }
      
      <!-- Tree -->
      @for (group of docGroups; let gi = $index; track group.id) {
        <div class="tree-item" [class.selected]="selectedGroup?.id === group.id">
          <div class="tree-item-header" (click)="selectGroup(group, $event)" (mouseenter)="hoveredGroupId = group.id" (mouseleave)="hoveredGroupId = null">
            <!-- <svg xmlns="http://www.w3.org/2000/svg" 
                 class="toggle-icon" 
                 [class.expanded]="group.expanded" 
                 fill="none" 
                 viewBox="0 0 24 24" 
                 stroke="currentColor" 
                 stroke-width="2"
                 (click)="toggleGroup(group, $event)">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg> -->
            <span class="text-gray-400">{{ gi + 1 }}.</span>
            <div class="name-with-mark">
              <span class="tree-item-name folder-name">{{ group.name }}</span>
              @if (groupsWithDrafts.has(group.id)) {
                <span class="draft-mark" title="Has drafts">•</span>
              }
            </div>
            <button class="delete-doc-button" 
                    [class.visible]="selectedGroup?.id === group.id && hoveredGroupId === group.id"
                    title="Delete part" 
                    (click)="deleteGroup(group, $event)">
              <svg xmlns="http://www.w3.org/2000/svg" 
                     width="14" 
                     height="14" 
                     fill="none" 
                     viewBox="0 0 24 24" 
                     stroke="currentColor" 
                     stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            <button class="add-doc-button" 
                    title="Add chapter to this part" 
                    (click)="createDocInGroup(group, $event)">
              <svg xmlns="http://www.w3.org/2000/svg" 
                   width="14" 
                   height="14" 
                   fill="none" 
                   viewBox="0 0 24 24" 
                   stroke="currentColor" 
                   stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
              </svg>
            </button>
          </div>
          
          @if (group.expanded) {
            <div class="tree-children">
            <!-- Nested groups -->
            @for (subGroup of group.groups; let si = $index; track subGroup.id) {
              <div class="tree-item nested" [class.selected]="selectedGroup?.id === subGroup.id">
                <div class="tree-item-header" (click)="selectGroup(subGroup, $event)" (mouseenter)="hoveredGroupId = subGroup.id" (mouseleave)="hoveredGroupId = null">
                  <svg xmlns="http://www.w3.org/2000/svg" 
                       class="toggle-icon" 
                       [class.expanded]="subGroup.expanded" 
                       fill="none" 
                       viewBox="0 0 24 24" 
                       stroke="currentColor" 
                       stroke-width="2"
                       (click)="toggleGroup(subGroup, $event)">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                  </svg>
                  <span class="folder-index">{{ si + 1 }}</span>
                  <div class="name-with-mark">
                    <span class="tree-item-name folder-name">{{ subGroup.name }}</span>
                    @if (groupsWithDrafts.has(subGroup.id)) {
                      <span class="draft-mark" title="Has drafts">•</span>
                    }
                  </div>
                  <button class="delete-doc-button" 
                          [class.visible]="selectedGroup?.id === subGroup.id && hoveredGroupId === subGroup.id"
                          title="Delete part" 
                          (click)="deleteGroup(subGroup, $event)">
                      <svg xmlns="http://www.w3.org/2000/svg" 
                           width="14" 
                           height="14" 
                           fill="none" 
                           viewBox="0 0 24 24" 
                           stroke="currentColor" 
                           stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                    </button>
                  <button class="add-doc-button" 
                          title="Add chapter to this part" 
                          (click)="createDocInGroup(subGroup, $event)">
                    <svg xmlns="http://www.w3.org/2000/svg" 
                         width="14" 
                         height="14" 
                         fill="none" 
                         viewBox="0 0 24 24" 
                         stroke="currentColor" 
                         stroke-width="2.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                  </button>
                </div>
                
                @if (subGroup.expanded) {
                  <div class="tree-children">
                  <!-- Documents -->
                  <div cdkDropList [cdkDropListData]="subGroup.docs" (cdkDropListDropped)="onDocsDrop(subGroup.id, $event)">
                  @for (doc of subGroup.docs; let di = $index; track doc.id) {
                    <div
                      class="tree-item doc nested-2"
                      [class.selected]="selectedDoc?.id === doc.id"
                      cdkDrag
                      cdkDragLockAxis="y"
                      cdkDragBoundary=".sidebar-content"
                      [cdkDragData]="doc"
                      (click)="selectDoc(doc)"
                      (mouseenter)="hoveredDocId = doc.id"
                      (mouseleave)="hoveredDocId = null">
                      <div class="tree-item-header">
                        <div class="working-marker-container">
                          @if (currentWorkingDocId === doc.id) {
                            <div class="working-marker active"></div>
                          }
                        </div>
                        <span class="doc-index">{{ si + 1 }}.{{ di + 1 }}</span>
                        <div class="name-with-mark">
                          <span class="tree-item-name">{{ doc.name }}</span>
                          @if (docsWithDrafts.has(doc.id)) {
                            <span class="draft-mark" title="Has drafts">•</span>
                          }
                        </div>
                        <button class="delete-doc-button" 
                                [class.visible]="selectedDoc?.id === doc.id && hoveredDocId === doc.id"
                                title="Delete chapter" 
                                (click)="deleteDoc(doc, $event)">
                            <svg xmlns="http://www.w3.org/2000/svg" 
                                 width="14" 
                                 height="14" 
                                 fill="none" 
                                 viewBox="0 0 24 24" 
                                 stroke="currentColor" 
                                 stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                          </button>
                      </div>
                      <div class="drag-preview" *cdkDragPreview>{{ doc.name }}</div>
                    </div>
                  }
                  </div>
                </div>
              }
              </div>
            }
            
            <!-- Direct docs in group -->
            <div cdkDropList [cdkDropListData]="group.docs" (cdkDropListDropped)="onDocsDrop(group.id, $event)">
            @for (doc of group.docs; let di = $index; track doc.id) {
              <div
                class="tree-item doc nested"
                [class.selected]="selectedDoc?.id === doc.id"
                cdkDrag
                cdkDragLockAxis="y"
                cdkDragBoundary=".sidebar-content"
                [cdkDragData]="doc"
                (click)="selectDoc(doc)"
                (mouseenter)="hoveredDocId = doc.id"
                (mouseleave)="hoveredDocId = null">
                <div class="tree-item-header">
                  <div class="working-marker-container">
                    @if (currentWorkingDocId === doc.id) {
                      <div class="working-marker active"></div>
                    }
                  </div>
                  <span class="doc-index">{{ gi + 1 }}.{{ di + 1 }}</span>
                  <div class="name-with-mark">
                    <span class="tree-item-name">{{ doc.name }}</span>
                    @if (docsWithDrafts.has(doc.id)) {
                      <span class="draft-mark" title="Has drafts">•</span>
                    }
                  </div>
                  <button class="delete-doc-button" 
                          [class.visible]="selectedDoc?.id === doc.id && hoveredDocId === doc.id"
                          title="Delete chapter" 
                          (click)="deleteDoc(doc, $event)">
                      <svg xmlns="http://www.w3.org/2000/svg" 
                           width="14" 
                           height="14" 
                           fill="none" 
                           viewBox="0 0 24 24" 
                           stroke="currentColor" 
                           stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                    </button>
                </div>
                <div class="drag-preview" *cdkDragPreview>{{ doc.name }}</div>
              </div>
            }
            </div>
          </div>
        }
        </div>
      }
      
      <!-- Add new part button -->
      <div class="tree-item add-folder-item">
        <div class="tree-item-header">
          <button class="add-doc-button" title="Add new part" (click)="createGroup()">
            <svg xmlns="http://www.w3.org/2000/svg" 
                 width="14" 
                 height="14" 
                 fill="none" 
                 viewBox="0 0 24 24" 
                 stroke="currentColor" 
                 stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Docker actions removed: migrated to global app docker -->

  <div class="resize-handle left" (mousedown)="startResize($event)" (dblclick)="onToggleCollapse()">
    <span class="divider-grip"></span>
  </div>
</aside>
