<aside class="left-sidebar">
  <div class="sidebar-header">
    <button class="icon-button-small" title="Back to projects" (click)="backClicked.emit()">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
  </div>

  <div class="sidebar-content">
    <div class="doc-tree" #docTree tabindex="0" (keydown)="handleTreeKeyDown($event)">
      <!-- Empty state -->
      @if (docGroups.length === 0) {
        <div class="empty-state">
          <p class="empty-message">No folders yet</p>
          <p class="empty-hint">Create your first folder</p>
        </div>
      }
      
      <!-- Tree -->
      @for (group of docGroups; let gi = $index; track group.id) {
        <div class="tree-item" [class.selected]="selectedGroup?.id === group.id">
          <div class="tree-item-header" (click)="selectGroup(group, $event)">
            <!-- <svg xmlns="http://www.w3.org/2000/svg" 
                 class="toggle-icon" 
                 [class.expanded]="group.expanded" 
                 fill="none" 
                 viewBox="0 0 24 24" 
                 stroke="currentColor" 
                 stroke-width="2"
                 (click)="toggleGroup(group, $event)">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg> -->
            <span class="text-gray-400">{{ gi + 1 }}.</span>
            <div class="name-with-mark">
              <span class="tree-item-name folder-name">{{ group.name }}</span>
              @if (groupsWithDrafts.has(group.id)) {
                <span class="draft-mark" title="Has drafts">•</span>
              }
            </div>
            <button class="add-doc-button" 
                    title="Add document to this folder" 
                    (click)="createDocInGroup(group, $event)">
              <svg xmlns="http://www.w3.org/2000/svg" 
                   width="14" 
                   height="14" 
                   fill="none" 
                   viewBox="0 0 24 24" 
                   stroke="currentColor" 
                   stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
              </svg>
            </button>
          </div>
          
          @if (group.expanded) {
            <div class="tree-children">
            <!-- Nested groups -->
            @for (subGroup of group.groups; let si = $index; track subGroup.id) {
              <div class="tree-item nested" [class.selected]="selectedGroup?.id === subGroup.id">
                <div class="tree-item-header" (click)="selectGroup(subGroup, $event)">
                  <svg xmlns="http://www.w3.org/2000/svg" 
                       class="toggle-icon" 
                       [class.expanded]="subGroup.expanded" 
                       fill="none" 
                       viewBox="0 0 24 24" 
                       stroke="currentColor" 
                       stroke-width="2"
                       (click)="toggleGroup(subGroup, $event)">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                  </svg>
                  <span class="folder-index">{{ si + 1 }}</span>
                  <div class="name-with-mark">
                    <span class="tree-item-name folder-name">{{ subGroup.name }}</span>
                    @if (groupsWithDrafts.has(subGroup.id)) {
                      <span class="draft-mark" title="Has drafts">•</span>
                    }
                  </div>
                  <button class="add-doc-button" 
                          title="Add document to this folder" 
                          (click)="createDocInGroup(subGroup, $event)">
                    <svg xmlns="http://www.w3.org/2000/svg" 
                         width="14" 
                         height="14" 
                         fill="none" 
                         viewBox="0 0 24 24" 
                         stroke="currentColor" 
                         stroke-width="2.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                  </button>
                </div>
                
                @if (subGroup.expanded) {
                  <div class="tree-children">
                  <!-- Documents -->
                  @for (doc of subGroup.docs; let di = $index; track doc.id) {
                    <div 
                      class="tree-item doc nested-2" 
                      [class.selected]="selectedDoc?.id === doc.id"
                      (click)="selectDoc(doc)">
                      <div class="tree-item-header">
                        <span class="doc-index">{{ si + 1 }}.{{ di + 1 }}</span>
                        <div class="name-with-mark">
                          <span class="tree-item-name">{{ doc.name }}</span>
                          @if (docsWithDrafts.has(doc.id)) {
                            <span class="draft-mark" title="Has drafts">•</span>
                          }
                        </div>
                      </div>
                    </div>
                  }
                </div>
              }
              </div>
            }
            
            <!-- Direct docs in group -->
            @for (doc of group.docs; let di = $index; track doc.id) {
              <div 
                class="tree-item doc nested" 
                [class.selected]="selectedDoc?.id === doc.id"
                (click)="selectDoc(doc)">
                <div class="tree-item-header">
                  <span class="doc-index">{{ gi + 1 }}.{{ di + 1 }}</span>
                  <div class="name-with-mark">
                    <span class="tree-item-name">{{ doc.name }}</span>
                    @if (docsWithDrafts.has(doc.id)) {
                      <span class="draft-mark" title="Has drafts">•</span>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        }
        </div>
      }
    </div>
  </div>
  
  <!-- Sidebar footer actions -->
  <div class="sidebar-footer">
    <div class="sidebar-actions">
      <button class="icon-button-small" title="New folder" (click)="createGroup()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
        </svg>
      </button>
      <button class="icon-button-small" title="Import folders" (click)="requestImportFolders()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v6m0 0l-3-3m3 3l3-3" />
        </svg>
      </button>
      <button class="icon-button-small" title="Import files" (click)="requestImportFiles()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v6m0 0l-3-3m3 3l3-3" />
        </svg>
      </button>
    </div>
    <button class="export-button" (click)="requestExportProject()" title="Export project">     
      <span>Export Project</span>
    </button>
  </div>

  <div class="resize-handle left" (mousedown)="startResize($event)" (dblclick)="onToggleCollapse()">
    <span class="divider-grip"></span>
  </div>
</aside>
