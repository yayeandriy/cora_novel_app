<div class="project-view">
  <!-- Header -->
  <header class="header">
    <button (click)="goBack()" class="back-button">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
      </svg>
      <span>{{ projectName }}</span>
    </button>
    
    <div class="header-actions">
      <button class="icon-button" title="Toggle left sidebar" (click)="toggleLeftSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      
      <button class="icon-button" title="Toggle right sidebar" (click)="toggleRightSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      </button>
    </div>
  </header>

  <!-- Main content area -->
  <div class="content-wrapper">
    <!-- Left Sidebar -->
    <aside *ngIf="!leftCollapsed" class="left-sidebar" [style.width.px]="leftWidth">
      <div class="sidebar-header">
        <span class="sidebar-title">Documents</span>
        <div class="sidebar-actions">
          <button class="icon-button-small" title="New folder" (click)="createGroup()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
            </svg>
          </button>
        </div>
      </div>
      
      <div class="sidebar-content">
        <div class="doc-tree" #docTree tabindex="0" (keydown)="handleTreeKeyDown($event)">
          <!-- Empty state -->
          <div *ngIf="docGroups.length === 0" class="empty-state">
            <p class="empty-message">No folders yet</p>
            <p class="empty-hint">Create your first folder</p>
          </div>
          
          <!-- Tree -->
          <ng-container *ngFor="let group of docGroups">
            <div class="tree-item" [class.selected]="selectedGroup?.id === group.id">
              <div class="tree-item-header" (click)="selectGroup(group, $event)">
                <svg xmlns="http://www.w3.org/2000/svg" 
                     class="toggle-icon" 
                     [class.expanded]="group.expanded" 
                     fill="none" 
                     viewBox="0 0 24 24" 
                     stroke="currentColor" 
                     stroke-width="2"
                     (click)="toggleGroup(group); $event.stopPropagation()">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="folder-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                </svg>
                <span class="tree-item-name">{{ group.name }}</span>
                <button class="add-doc-button" 
                        title="Add document to this folder" 
                        (click)="createDocInGroup(group); $event.stopPropagation()">
                  <svg xmlns="http://www.w3.org/2000/svg" 
                       width="14" 
                       height="14" 
                       fill="none" 
                       viewBox="0 0 24 24" 
                       stroke="currentColor" 
                       stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                  </svg>
                </button>
              </div>
              
              <div *ngIf="group.expanded" class="tree-children">
                <!-- Nested groups -->
                <ng-container *ngFor="let subGroup of group.groups">
                  <div class="tree-item nested" [class.selected]="selectedGroup?.id === subGroup.id">
                    <div class="tree-item-header" (click)="selectGroup(subGroup, $event)">
                      <svg xmlns="http://www.w3.org/2000/svg" 
                           class="toggle-icon" 
                           [class.expanded]="subGroup.expanded" 
                           fill="none" 
                           viewBox="0 0 24 24" 
                           stroke="currentColor" 
                           stroke-width="2"
                           (click)="toggleGroup(subGroup); $event.stopPropagation()">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                      </svg>
                      <svg xmlns="http://www.w3.org/2000/svg" class="folder-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                      </svg>
                      <span class="tree-item-name">{{ subGroup.name }}</span>
                      <button class="add-doc-button" 
                              title="Add document to this folder" 
                              (click)="createDocInGroup(subGroup); $event.stopPropagation()">
                        <svg xmlns="http://www.w3.org/2000/svg" 
                             width="14" 
                             height="14" 
                             fill="none" 
                             viewBox="0 0 24 24" 
                             stroke="currentColor" 
                             stroke-width="2.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                        </svg>
                      </button>
                    </div>
                    
                    <div *ngIf="subGroup.expanded" class="tree-children">
                      <!-- Documents -->
                      <div *ngFor="let doc of subGroup.docs" 
                           class="tree-item doc nested-2" 
                           [class.selected]="selectedDoc?.id === doc.id"
                           (click)="selectDoc(doc)">
                        <div class="tree-item-header">
                          <svg xmlns="http://www.w3.org/2000/svg" class="doc-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                          </svg>
                          <span class="tree-item-name">{{ doc.name }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
                
                <!-- Direct docs in group -->
                <div *ngFor="let doc of group.docs" 
                     class="tree-item doc nested" 
                     [class.selected]="selectedDoc?.id === doc.id"
                     (click)="selectDoc(doc)">
                  <div class="tree-item-header">
                    <svg xmlns="http://www.w3.org/2000/svg" class="doc-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span class="tree-item-name">{{ doc.name }}</span>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
      
      <div class="resize-handle left" (mousedown)="startResizeLeft($event)"></div>
    </aside>

    <!-- Editor -->
    <main class="editor-area">
      <!-- Document editor -->
      <div *ngIf="selectedDoc && !selectedGroup" class="editor-container">
        <div class="editor-toolbar">
          <input 
            #docTitleInput
            type="text" 
            class="doc-title-input" 
            [(ngModel)]="selectedDoc.name"
            (blur)="renameDoc(selectedDoc)"
            (keydown.enter)="focusEditor()"
            placeholder="Untitled">
          <div class="toolbar-actions">
            <div *ngIf="showSaveStatus || hasUnsavedChanges" class="save-status">
              <svg xmlns="http://www.w3.org/2000/svg" class="save-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
              </svg>
              <span *ngIf="showSaveStatus" class="save-text">Saved</span>
              <span *ngIf="!showSaveStatus && hasUnsavedChanges" class="save-text">Unsaved</span>
            </div>
          </div>
        </div>
        
        <textarea 
          #editorTextarea
          [(ngModel)]="selectedDoc.text"
          (input)="onDocumentTextChange()"
          class="editor-textarea"
          (blur)="saveDoc()"
          placeholder="Start writing...">
        </textarea>
        
        <div class="editor-footer">
          <span class="word-count">{{ getWordCount() }} words</span>
        </div>
      </div>

      <!-- Group view -->
      <div *ngIf="selectedGroup && !selectedDoc" class="editor-container">
        <div class="editor-toolbar">
          <input 
            #groupNameInput
            type="text" 
            class="doc-title-input" 
            [(ngModel)]="selectedGroup.name"
            (blur)="renameGroup(selectedGroup)"
            (keydown.enter)="focusTree()"
            placeholder="Folder name">
          <div class="toolbar-actions">
            <button class="toolbar-button" (click)="createDoc()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
              </svg>
              <span>New Document</span>
            </button>
          </div>
        </div>
        
        <div class="group-content">
          <p class="group-empty-message">Select a document to start editing or create a new one</p>
        </div>
      </div>
      
      <!-- Empty state -->
      <div *ngIf="!selectedDoc && !selectedGroup" class="editor-empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" class="empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="empty-message">No document selected</p>
        <p class="empty-hint">Create a folder and add documents to start writing</p>
      </div>
    </main>

    <!-- Right Sidebar -->
    <aside *ngIf="!rightCollapsed" class="right-sidebar" [style.width.px]="rightWidth">
      <div class="resize-handle right" (mousedown)="startResizeRight($event)"></div>
      
      <div class="sidebar-content">
        <!-- Characters Section -->
        <div class="sidebar-section">
          <div class="section-header" (click)="charactersExpanded = !charactersExpanded">
            <div class="section-title">
              <svg xmlns="http://www.w3.org/2000/svg" class="toggle-icon" [class.expanded]="charactersExpanded" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
              <span>Characters</span>
            </div>
            <button class="add-button">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
              </svg>
            </button>
          </div>
          
          <div *ngIf="charactersExpanded" class="section-content">
            <div *ngFor="let char of characters" class="list-item">
              {{ char.name }}
            </div>
          </div>
        </div>

        <!-- Events Section -->
        <div class="sidebar-section">
          <div class="section-header" (click)="eventsExpanded = !eventsExpanded">
            <div class="section-title">
              <svg xmlns="http://www.w3.org/2000/svg" class="toggle-icon" [class.expanded]="eventsExpanded" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
              <span>Events ({{ events.length }}/4)</span>
            </div>
            <button class="add-button">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
              </svg>
            </button>
          </div>
          
          <div *ngIf="eventsExpanded" class="section-content">
            <div *ngFor="let event of events" class="event-item">
              <div class="event-name">{{ event.name }}</div>
              <div *ngIf="event.desc" class="event-desc">{{ event.desc }}</div>
              <div *ngIf="event.startDate" class="event-date">
                {{ event.startDate }}{{ event.endDate && event.endDate !== event.startDate ? ' - ' + event.endDate : '' }}
              </div>
            </div>
          </div>
        </div>

        <!-- Notes Section -->
        <div class="sidebar-section">
          <div class="section-header" (click)="notesExpanded = !notesExpanded">
            <div class="section-title">
              <svg xmlns="http://www.w3.org/2000/svg" class="toggle-icon" [class.expanded]="notesExpanded" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
              <span>Notes</span>
            </div>
          </div>
          
          <div *ngIf="notesExpanded" class="section-content">
            <textarea 
              *ngIf="selectedDoc"
              class="notes-textarea" 
              [(ngModel)]="selectedDoc.notes"
              (input)="onDocumentNotesChange()"
              placeholder="Add notes..."></textarea>
          </div>
        </div>

        <!-- Drafts Section -->
        <div class="sidebar-section">
          <div class="section-header" (click)="draftsExpanded = !draftsExpanded">
            <div class="section-title">
              <svg xmlns="http://www.w3.org/2000/svg" class="toggle-icon" [class.expanded]="draftsExpanded" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
              <span>Drafts</span>
            </div>
            <button class="icon-button-small" 
                    title="Add new draft" 
                    (click)="createDraft(); $event.stopPropagation()">
              <svg xmlns="http://www.w3.org/2000/svg" 
                   width="14" 
                   height="14" 
                   fill="none" 
                   viewBox="0 0 24 24" 
                   stroke="currentColor" 
                   stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
              </svg>
            </button>
          </div>
          
          <div *ngIf="draftsExpanded" class="section-content">
            <div *ngIf="drafts.length === 0" class="empty-text">No drafts</div>
            <div *ngFor="let draft of drafts; let i = index" class="draft-container">
              <div class="draft-header">
                <div class="draft-name">{{ draft.name }}</div>
                <div class="draft-actions">
                  <div class="draft-status" [class.synced]="draftSyncStatus[draft.id] === 'synced'" [class.syncing]="draftSyncStatus[draft.id] === 'syncing'">
                    {{ draftSyncStatus[draft.id] === 'syncing' ? '⟳' : (draftSyncStatus[draft.id] === 'synced' ? '✓' : '●') }}
                  </div>
                  <button class="delete-draft-button" 
                          title="Delete draft" 
                          (click)="deleteDraft(draft.id); $event.stopPropagation()">
                    <svg xmlns="http://www.w3.org/2000/svg" 
                         width="14" 
                         height="14" 
                         fill="none" 
                         viewBox="0 0 24 24" 
                         stroke="currentColor" 
                         stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                  </button>
                </div>
              </div>
              <textarea
                class="draft-textarea"
                [value]="getDraftLocalContent(draft.id)"
                (input)="onDraftChange(draft.id, $event)"
                (blur)="onDraftBlur(draft.id)"
                [placeholder]="'Draft: ' + draft.name">
              </textarea>
              <div class="draft-time">{{ draft.updated_at | date:'short' }}</div>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</div>
